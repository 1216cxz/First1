import streamlit as st
import pandas as pd

# ì œëª©
st.title("2025ë…„ 5ì›” ì—°ë ¹ë³„ ì¸êµ¬ í˜„í™© ë¶„ì„")

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
uploaded_file = st.file_uploader("CSV íŒŒì¼ ì—…ë¡œë“œ (EUC-KR ì¸ì½”ë”©)", type="csv")

if uploaded_file is not None:
    # ë°ì´í„° ì½ê¸°
    df = pd.read_csv(uploaded_file, encoding="EUC-KR")

    # ì—´ ì´ë¦„ ì „ì²˜ë¦¬
    original_columns = df.columns.tolist()
    age_columns = [col for col in original_columns if col.startswith("2025ë…„05ì›”_ê³„_")]
    df = df.rename(columns={col: col.replace("2025ë…„05ì›”_ê³„_", "") for col in age_columns})

    # 'ì´ì¸êµ¬ìˆ˜' ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ë©´ ì´ë¦„ ìœ ì§€, ì—†ë‹¤ë©´ ì¶”ì •
    if 'ì´ì¸êµ¬ìˆ˜' not in df.columns:
        df['ì´ì¸êµ¬ìˆ˜'] = df[[col for col in df.columns if col.isdigit()]].sum(axis=1)

    # ì´ì¸êµ¬ìˆ˜ ê¸°ì¤€ ìƒìœ„ 5ê°œ í–‰ì •êµ¬ì—­ ì¶”ì¶œ
    df_top5 = df.nlargest(5, 'ì´ì¸êµ¬ìˆ˜')

    # ì—°ë ¹ ì»¬ëŸ¼ë§Œ ì„ íƒ (ìˆ«ìì¸ ì»¬ëŸ¼ë§Œ)
    age_cols = [col for col in df.columns if col.isdigit()]

    st.subheader("ğŸ“Š ì›ë³¸ ë°ì´í„° (ì¼ë¶€ ë¯¸ë¦¬ë³´ê¸°)")
    st.dataframe(df.head())

    st.subheader("ğŸ‘‘ ì´ì¸êµ¬ìˆ˜ ê¸°ì¤€ ìƒìœ„ 5ê°œ ì§€ì—­")
    st.dataframe(df_top5[['í–‰ì •êµ¬ì—­', 'ì´ì¸êµ¬ìˆ˜']])

    st.subheader("ğŸ“ˆ ì—°ë ¹ë³„ ì¸êµ¬ ì„  ê·¸ë˜í”„ (ìƒìœ„ 5ê°œ ì§€ì—­)")

    # ê·¸ë˜í”„ ì‹œê°í™” (ê° í–‰ì •êµ¬ì—­ë³„ë¡œ ì°¨íŠ¸ ê·¸ë¦¬ê¸°)
    for idx, row in df_top5.iterrows():
        st.markdown(f"#### ğŸ“ {row['í–‰ì •êµ¬ì—­']}")
        age_data = pd.DataFrame({
            "ì—°ë ¹": list(map(int, age_cols)),
            "ì¸êµ¬ìˆ˜": row[age_cols].astype(int).values
        }).set_index("ì—°ë ¹")

        st.line_chart(age_data)

else:
    st.info("ì™¼ìª½ ì‚¬ì´ë“œë°” ë˜ëŠ” ìœ„ì—ì„œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.")
